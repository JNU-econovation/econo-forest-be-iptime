## Ranking

+ 대상 : Ranking 서비스의 기능을 파악하고 싶을 개발자
+ 목적 : Ranking 서비스의 기능 파악을 돕기위해 작성하였다.
+ 업데이트 : 2023.02.03

Ranking 서비스는 RANKING 주소와 관련된 서비스이다.

Ranking 서비스의 기능 목록은 아래와 같다.

### 기능 목록

1. 사용자는 모에숲의 홈페이지에서 상위 랭킹 인원을 확인할 수 있다.
    + 한달 사이의 동방 출석을 기준으로 산출한 랭킹 정보를 확인할 수 있다.
2. 사용자는 모에숲의 랭킹 페이지에서 랭킹을 확인할 수 있다.
    + 일정 기간(일년, 한달, 일주일) 사이의 동방 출석을 기준으로 산출한 랭킹 정보를 확인할 수 있다.
3. 사용자는 모에숲의 랭킹 페이지에서 자신의 랭킹과 월간 방문 횟수를 확인할 수 있다.
    + 일정 기간(일년, 한달, 일주일) 사이의 동방 출석을 기준으로 산출한 자신의 랭킹 정보를 확인할 수 있다.


### 1,2. 랭킹

<img width="406" alt="스크린샷 2023-01-28 오후 8 31 44" src="https://user-images.githubusercontent.com/102807742/215264201-8045d32f-1579-4199-b309-ce430281fa7d.png">

동방 출석 기록을 바탕으로 서비스 사용자들의 랭킹을 계산 한다.

이때 동점인 인원들은 반환 순서를 무작위로 섞어준다.

그리고 idp에서 각 유저 정보를 조회하여 유저 정보와 함께 랭킹을 반환한다.

### 3. 맴버별 랭킹과 방문횟수

<img width="484" alt="스크린샷 2023-01-28 오후 8 29 49" src="https://user-images.githubusercontent.com/102807742/215264116-b63798d3-6576-4864-8a99-cc6475c9b0bf.png">

우선 idp 서버에서 유저에 대한 정보를 조회한다.

그리고 동방 출석 기록을 바탕으로 서비스 사용자들의 랭킹을 계산한다.

그 결과를 속에서 맴버의 랭킹을 조회한다.

이후 맴버의 방문횟수를 조회하여 랭킹의 결과와 함께 반환한다.

### 예상되는 문제

1,2,3 모두 전체 랭킹을 조회해야 한다.

랭킹은 많이 변하지 않을 정보인데 매번 조회와 계산 과정을 거처야 하기에 비효율적일 것이라 판단된다.

이를 해결하기 위해 랭킹을 캐싱하는 방안이 필요해 보인다. ([해결링크](https://github.com/JNU-econovation/econo-forest-be-iptime/blob/main/docs/problem/%EB%9E%AD%ED%82%B9%EA%B4%80%EB%A0%A8%EB%AC%B8%EC%A0%9C.md))